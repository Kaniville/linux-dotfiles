#!/bin/python3

from os import listdir, path
from random import choice
from subprocess import run
from argparse import ArgumentParser

# Argument parser setup
argument_parser = ArgumentParser()
argument_parser.add_argument('-r', '--random', required=False, help='Select a random wallpaper from a directory')
option = argument_parser.parse_args()

# Default directory to store background
background_dir = path.abspath(path.expanduser(option.random))


# Get random wallpaper from a selected directory and set it
def random_wallpaper():
    random_wallpaper = choice(listdir(background_dir))
    wallpaper_file = f'{background_dir}/{random_wallpaper}'

    try:
        set_wallpaper(wallpaper_file)
    except:
        exit("Please check that the chosen directory contains only the images.")


# Set gnome wallpaper
def set_wallpaper(wallpaper_file):
    run(['gsettings', 'set', 'org.gnome.desktop.background', 'picture-uri', f'file://{wallpaper_file}'], check=True)
    run(['gsettings', 'set', 'org.gnome.desktop.background', 'picture-uri-dark', f'file://{wallpaper_file}'], check=True)


# Select an option
if option.random:
    random_wallpaper()
